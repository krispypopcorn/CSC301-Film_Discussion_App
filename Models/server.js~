/* server.js nov19 - 3pm */
'use strict';
const log = console.log;

const express = require('express')
const port = process.env.PORT || 3000
const bodyParser = require('body-parser') // middleware for parsing HTTP body from client
const { ObjectID } = require('mongodb')

// Import our mongoose connection
const { mongoose } = require('./db/mongoose');

// Import the models
const { Movie } = require('./Movie')

// express
const app = express();
// body-parser middleware setup.  Will parse the JSON and convert to object
app.use(bodyParser.json());

/// Routes go below

// Set up a POST route to create a student
app.post('/Movies', (req, res) => {
	log(req.body)

	// Create a new student
	const movie = new Movie({
		name: req.body.name,
		year: req.body.year,
		poster: "poster",
		banner: "banner",
		numOfComments: 10,
		vote_average:0,
		discussions:[]
	})

	// save student to database
	movie.save().then((result) => {
		// Save and send object that was saved
		res.send({result})
	}, (error) => {
		res.status(400).send(error) // 400 for bad request
	})

})

// GET all students
app.get('/Movies', (req, res) => {
	Movie.find().then((students) => {
		res.send({ students }) // put in object in case we want to add other properties
	}, (error) => {
		res.status(400).send(error)
	})
})


app.listen(port, () => {
	log(`Listening on port ${port}...`)
});








